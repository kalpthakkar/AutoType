<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AutoTyper Sender</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 font-sans">
  <div class="max-w-2xl mx-auto p-6 bg-white shadow-md rounded-lg mt-10">
    <h1 class="text-2xl font-bold mb-4 text-center">AutoTyper Sender</h1>

    <label class="block mb-2 font-medium">Code to Type:</label>
    <textarea id="codeInput" rows="10" class="w-full p-2 border rounded mb-4" placeholder="Enter code or message here..."></textarea>

    <div class="flex justify-between mb-4">
      <button id="runBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Run</button>
      <button id="pauseBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded">Pause</button>
      <button id="randomBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">Random: On</button>
      <button id="stopBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">Stop</button>
    </div>

    <div class="flex items-center mb-4 space-x-4">
      <div>
        <label class="block font-medium">Backspace</label>
        <input type="number" id="backspaceCount" class="w-24 border p-1 rounded" value="1">
        <button onclick="sendCursorCommand('backspace')" class="ml-1 bg-gray-700 text-white px-2 py-1 rounded">Go</button>
      </div>
      <div>
        <label class="block font-medium">Left</label>
        <input type="number" id="leftCount" class="w-24 border p-1 rounded" value="1">
        <button onclick="sendCursorCommand('left')" class="ml-1 bg-gray-700 text-white px-2 py-1 rounded">Go</button>
      </div>
      <div>
        <label class="block font-medium">Right</label>
        <input type="number" id="rightCount" class="w-24 border p-1 rounded" value="1">
        <button onclick="sendCursorCommand('right')" class="ml-1 bg-gray-700 text-white px-2 py-1 rounded">Go</button>
      </div>
    </div>
  </div>

  <script>
    const receiverUrl = "{{ receiver_url }}";

    document.getElementById('runBtn').onclick = async () => {
      const code = document.getElementById('codeInput').value;
      if (!code.trim()) return alert("Code is empty.");
      await sendCommand("type", code);
    };

    document.getElementById('pauseBtn').onclick = async () => {
      const status = await getStatus();
      const action = status.paused ? "resume" : "pause";
      await sendCommand(action);
      updateStatus();
    };

    document.getElementById('randomBtn').onclick = async () => {
      await sendCommand("toggle_random");
      updateStatus();
    };

    document.getElementById('stopBtn').onclick = async () => {
      await sendCommand("stop");
      updateStatus();
    };

    async function sendCursorCommand(cmd) {
      let count = document.getElementById(cmd + 'Count').value;
      await sendCommand(cmd, parseInt(count));
    }

    async function sendCommand(action, data = null) {
      const res = await fetch(`${receiverUrl}/command`, {
        method: "POST",
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ action, data })
      });
      return await res.json();
    }

    async function getStatus() {
      const res = await fetch(`${receiverUrl}/status`);
      return await res.json();
    }

    async function updateStatus() {
      const status = await getStatus();
      document.getElementById("pauseBtn").textContent = status.paused ? "Resume" : "Pause";
      document.getElementById("randomBtn").textContent = `Random: ${status.randomize ? "On" : "Off"}`;
    }

    window.onload = updateStatus;
  </script>
</body>
</html>